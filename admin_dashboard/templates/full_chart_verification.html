<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mode B - 灵伴主导式全盘验证</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/verify.css') }}">
    <style>
        /* Mode B 特定样式 */
        .mode-b-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .import-section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .import-status {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .status-card {
            flex: 1;
            background: #1a1a1a;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #666;
        }

        .status-card.imported {
            border-left-color: #00ff9d;
        }

        .status-card.pending {
            border-left-color: #ffa500;
        }

        .sop-selector {
            margin: 20px 0;
        }

        .sop-selector select {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }

        .ai-message-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            color: white;
        }

        .ai-message-box .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .start-analysis-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #00ff9d 0%, #00d4aa 100%);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-analysis-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 157, 0.3);
        }

        .start-analysis-btn:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
            transform: none;
        }

        .analysis-results {
            display: none;
            margin-top: 30px;
        }

        .analysis-results.visible {
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .ai-column {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
        }

        .ai-column h3 {
            color: #00ff9d;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #444;
        }

        .module-result {
            background: #1a1a1a;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .module-result h4 {
            color: #00d4aa;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .module-result .summary {
            color: #e0e0e0;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .confidence-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 8px;
        }

        .confidence-high {
            background: rgba(0, 255, 157, 0.2);
            color: #00ff9d;
        }

        .confidence-medium {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }

        .confidence-low {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .evidence-list {
            font-size: 13px;
            color: #aaa;
            margin-top: 8px;
            padding-left: 20px;
        }

        .evidence-list li {
            margin-bottom: 4px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #444;
            border-top-color: #00ff9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .ai-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 24px;
            border-radius: 12px;
            margin-top: 30px;
            color: white;
        }

        .ai-summary h3 {
            margin-bottom: 16px;
            font-size: 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #2a2a2a;
            border-radius: 12px;
            overflow: hidden;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        .comparison-table th {
            background: #1a1a1a;
            color: #00ff9d;
            font-weight: bold;
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border-left: 4px solid #ff4444;
            padding: 16px;
            border-radius: 8px;
            color: #ff6b6b;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <div class="mode-b-container">
        <h1>Mode B - 灵伴主导式全盘验证</h1>

        <!-- 导入状态区 -->
        <div class="import-section">
            <h2>命盘导入状态</h2>
            <div class="import-status">
                <div class="status-card" id="baziStatus">
                    <h3>八字命盘</h3>
                    <p class="status-text">等待导入...</p>
                    <button onclick="importChart('bazi')" class="btn-secondary">导入八字 JSON</button>
                    <input type="file" id="baziFileInput" accept=".json" style="display:none;">
                </div>
                <div class="status-card" id="ziweiStatus">
                    <h3>紫微命盘</h3>
                    <p class="status-text">等待导入...</p>
                    <button onclick="importChart('ziwei')" class="btn-secondary">导入紫微 JSON</button>
                    <input type="file" id="ziweiFileInput" accept=".json" style="display:none;">
                </div>
            </div>

            <!-- SOP 模板选择 -->
            <div class="sop-selector">
                <label for="sopTemplate">
                    <strong>选择 SOP 分析模板：</strong>
                </label>
                <select id="sopTemplate">
                    <option value="">-- 请选择分析模板 --</option>
                    <option value="standard_v1">标准全盘分析 v1.0</option>
                    <option value="career_focused_v1">事业重点分析 v1.0</option>
                    <option value="relationship_focused_v1">感情重点分析 v1.0</option>
                </select>
                <button onclick="uploadCustomSOP()" class="btn-secondary" style="margin-top: 12px;">
                    上传自定义 SOP 模板
                </button>
                <input type="file" id="sopFileInput" accept=".json" style="display:none;">
            </div>
        </div>

        <!-- 灵伴提示区 -->
        <div class="ai-message-box" id="aiMessageBox" style="display:none;">
            <div class="icon">👋</div>
            <div class="message">
                <strong>命盘导入完成。</strong><br>
                接下来我会依据此出生时辰，依次分析六亲、童年、事件、感情、事业与健康。<br>
                点击下方【开始分析】按钮即可启动全盘验证。
            </div>
        </div>

        <!-- 开始分析按钮 -->
        <button id="startAnalysisBtn" class="start-analysis-btn" disabled onclick="startFullChartAnalysis()">
            请先导入命盘并选择模板
        </button>

        <!-- 分析结果区 -->
        <div class="analysis-results" id="analysisResults">
            <h2>分析结果</h2>

            <!-- 并排显示八字与紫微分析 -->
            <div class="results-grid">
                <div class="ai-column" id="baziResults">
                    <h3>八字 AI 分析</h3>
                    <div class="loading" style="text-align: center; padding: 40px; color: #888;">
                        <div class="loading-spinner"></div>
                        分析中...
                    </div>
                </div>
                <div class="ai-column" id="ziweiResults">
                    <h3>紫微 AI 分析</h3>
                    <div class="loading" style="text-align: center; padding: 40px; color: #888;">
                        <div class="loading-spinner"></div>
                        分析中...
                    </div>
                </div>
            </div>

            <!-- 对比表格 -->
            <h3 style="margin-top: 40px; color: #00ff9d;">分析对比</h3>
            <table class="comparison-table" id="comparisonTable">
                <thead>
                    <tr>
                        <th>模块</th>
                        <th>八字结论</th>
                        <th>紫微结论</th>
                        <th>一致度</th>
                    </tr>
                </thead>
                <tbody id="comparisonBody">
                    <!-- 动态填充 -->
                </tbody>
            </table>

            <!-- 灵伴总结 -->
            <div class="ai-summary" id="aiSummary" style="display:none;">
                <h3>🪶 灵伴总结</h3>
                <div id="summaryContent"></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/full_chart_verification.js') }}"></script>
</body>
</html>
